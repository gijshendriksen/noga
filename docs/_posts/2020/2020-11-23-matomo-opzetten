---
layout: "post"
title: "Zelf matomo opzetten"
author: "Pepijn Boers"
date: "2020-11-23 15:00"
excerpt: "Beginners handleiding voor het zelf opzetten van matomo."
tags: NoGA matomo setup opzetten Docker
---

Matomo Analytics biedt privacy vriendelijke software voor het bijhouden van bezoekersaantallen en statistieken van uw website. Het grote voordeel is dat u met het gebruik van matomo alle data in eigen beheer kunt houden en zo de data van uw bezoekers beter kunt beschermen. Het is daardoor niet langer nodig om op andere partijen uw data te laten beheren. Het grote struikelpunt is echter, dat het zelf opzetten van zo een in-house systeem behoorlijk wat technische kennis kan vergen. In deze blog leer je hoe je zelf een basis versie van matomo kunt hosten. 

De makers van matomo zijn gebaat bij een zo eenvoudig mogelijke installatie voor hun gebruikers en bieden [hier](https://matomo.org/docs/installation/) een stappenplan. Voor gebruikers zonder enkele technische kennis biedt matomo een kant-en-klare versie via [matomo Cloud](https://matomo.org/matomo-cloud/). U betaalt dan een standaard bedrag per maand waarnaar hosting, onderhoud en backups voor u geregeld worden. 

De voornaamste moeilijkheden zitten hem in het regelen van een virtuele of dedicated server en het opzetten van een aantal optimalisatie instructies (waaronder het systematisch archiveren van raporten) - deze zullen worden beschreven in een volgende blog. In deze blog lopen we door de basisstappen om de standaard matomo webserver te hosten. Om het u zo makkelijk mogelijk te maken hebben wij al een aantal stukken code voor u geschreven die te downloaden zijn vanaf [deze](https://github.com/PepijnBoers/matomo-compose) repository of via:

```bash
git clone https://github.com/PepijnBoers/matomo-compose.git
```

## Een server
Voordat er naar matomo gekeken kan worden, dient u eerst toegang te hebben tot een server. Deze kunt u zelf aanschaffen of ergens huren, bijvoorbeeld via AWS, Azure of Google Cloud. Voor deze tutorial is het van belang dat u een `ssh` verbinding kunt maken met uw server (poort 22) en dat u de poorten voor `HTTP` (80) en `HTTPS` (443) open zet. Uitleg hierover is vrijwel altijd beschikbaar op pagina's van de desbetreffende hosting maatschappij. Hier vindt u een documentatie van de door ons gebruikte opties: [AWS](https://gitlab.science.ru.nl/mdessing/noga/-/tree/master/setup/aws.md) of [Bare Metal](https://gitlab.science.ru.nl/mdessing/noga/-/tree/master/setup/bare_metal.md) (engels).

## Matomo
Om makkelijk en onafhankelijk de juiste omgeving voor matomo te creëren, gebruiken we een combinatie van verschillende [Docker](https://www.strato.nl/server/docker-tutorial/) containers. Het bouwen en beheren van deze containers wordt gedaan door `docker-compose` - een tool waarmee een specifieke figuratie van virtuele omgevingen kan worden opgeroepen. De configuratie file bevat de instructies voor Docker om de juiste containers op te starten en met elkaar te laten samenwerken. Daarnaast houdt docker-compose ook een oogje in het zeil wat betreft 'gezondheid' van de containers, en worden corrupte container automatisch herstart. Het is dus belangrijk dat Docker geinstalleerd is voordat u verder gaat.

### De database
Om de statistieken van uw website ergens op te slaan is een database nodig, bijvoorbeeld MySQL of MariaDB. In deze tutorial gebruiken we een MySQL docker container voor het beheren van de data. In de gedownloade bestanden vindt u de `setup-db.sql` setup file voor de mysql database:


```mysql
-- CREATE DATABASE matomo;

CREATE USER 'matomo'@'%' IDENTIFIED WITH mysql_native_password BY '#your_secret_password';
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, INDEX, DROP, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES ON matomo.* TO 'matomo'@'%';
GRANT FILE ON *.* TO 'matomo'@'%';
```


### De webserver
Om verbinding met matomo maken is een webserver nodig, hiervoor gebruiken we een aparte Nginx container. Nginx regelt de communicatie tussen gebruiker en matomo. Het is ook mogelijk om matomo's ingebouwde webserver te gebruiken, echter biedt een aparte Nginx webserver in latere fases meer voordelen. Het is belangrijk dat de `server_name` in `nginx/nginx/conf` naar uw website/host verwijst:

```
server_name uw-matomo-website.nl www.uw-matomo-website.nl;
```

_Het wordt aangeraden om een beveiligde verbinding te creëren via het SSL protocol. Hierdoor beveiligt u alle communicatie tussen gebruiker en matomo. Een SSL certificaat kan aangevraagd worden via een Certificate Authority (CA)._

Start de matomo webserver met docker-compose:

```bash
docker-compose up
```

Bezoek nu de door u ingestelde host.

### Matomo Installatie
Als het goed is gegaan ziet u nu een welkom scherm van matomo. U kunt bovenin de gewenste taal kiezen. Als u op 'volgende' drukt wordt er een systeem controle uitgevoerd, hierna kunt de database installen. Als u niks aan wachtwoorden heeft veranderd vult u in de lege velden het volgende in:

* Inloggen: matomo
* Wachtwoord: #your_secret_password
* Naam database: matomo

Hierna kunt u de super user account aanmaken en een eerste website waarvan u de statistieke wilt bijhouden instellen. Er verschijnt nu een `Javascript Tracking Code` die u op uw website kunt plaatsen.